// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG (MOCK DATA) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG C·ª¶A B·∫†N (80 T·ª™) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 4) ---

// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 3) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 5) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 6) ---
const vocabularyData = [
  {
    id: 1,
    word: "shovel",
    ipa: "/Àà É åv.…ôl/",
    meaning: "c√°i x·∫ªng, c√°i x√∫c",
    example: "He used a shovel to dig a hole in the garden.",
  },
  {
    id: 2,
    word: "walkway",
    ipa: "/Ààw…îÀêkwe…™/",
    meaning: "h√†nh lang, l·ªëi ƒëi b·ªô",
    example: "Keep the walkway clear of obstacles.",
  },
  {
    id: 3,
    word: "tray",
    ipa: "/tre…™/",
    meaning: "khay, m√¢m",
    example: "The waiter carried a tray of drinks.",
  },
  {
    id: 4,
    word: "trolley",
    ipa: "/Ààtr…íl.i/",
    meaning: "xe ƒë·∫©y",
    example: "Put your luggage on the trolley.",
  },
  {
    id: 5,
    word: "replace",
    ipa: "/r…™Ààple…™s/",
    meaning: "thay th·∫ø",
    example: "I need to replace the battery in my watch.",
  },
  {
    id: 6,
    word: "outdoor",
    ipa: "/Ààa ätÀåd…îÀêr/",
    meaning: "ngo√†i tr·ªùi",
    example: "We enjoy outdoor activities like hiking.",
  },
  {
    id: 7,
    word: "unoccupied",
    ipa: "/ ånÀà…ík.j…ô.pa…™d/",
    meaning: "tr·ªëng, kh√¥ng c√≥ ng∆∞·ªùi d√πng",
    example: "The seat next to me is unoccupied.",
  },
  {
    id: 8,
    word: "arrange",
    ipa: "/…ôÀàre…™nd í/",
    meaning: "s·∫Øp x·∫øp",
    example: "Please arrange the chairs in a circle.",
  },
  {
    id: 9,
    word: "entrance",
    ipa: "/Ààen.tr…ôns/",
    meaning: "l·ªëi v√†o",
    example: "Meet me at the main entrance.",
  },
  {
    id: 10,
    word: "pile",
    ipa: "/pa…™l/",
    meaning: "ch·ªìng, ƒë·ªëng",
    example: "There is a pile of books on the desk.",
  },
  {
    id: 11,
    word: "brick",
    ipa: "/br…™k/",
    meaning: "g·∫°ch",
    example: "The house is built of red brick.",
  },
  {
    id: 12,
    word: "reasonable",
    ipa: "/ÀàriÀê.z…ôn.…ô.b…ôl/",
    meaning: "h·ª£p l√Ω",
    example: "The price was very reasonable.",
  },
  {
    id: 13,
    word: "sign up for",
    ipa: "/sa…™n  åp f…îÀêr/",
    meaning: "ƒëƒÉng k√Ω tham gia",
    example: "I want to sign up for the yoga class.",
  },
  {
    id: 14,
    word: "subscription",
    ipa: "/s…ôbÀàskr…™p. É…ôn/",
    meaning: "s·ª± ƒëƒÉng k√Ω (b√°o, t·∫°p ch√≠...)",
    example: "I renewed my magazine subscription.",
  },
  {
    id: 15,
    word: "budget",
    ipa: "/Ààb åd í.…™t/",
    meaning: "ng√¢n s√°ch",
    example: "We are on a tight budget.",
  },
  {
    id: 16,
    word: "annual",
    ipa: "/Àà√¶n.ju.…ôl/",
    meaning: "th∆∞·ªùng ni√™n",
    example: "The company holds an annual meeting.",
  },
  {
    id: 17,
    word: "maintenance",
    ipa: "/Ààme…™n.t…ôn.…ôns/",
    meaning: "s·ª± b·∫£o d∆∞·ª°ng",
    example: "The car needs regular maintenance.",
  },
  {
    id: 18,
    word: "certificate",
    ipa: "/s…ôÀàt…™f.…™.k…ôt/",
    meaning: "gi·∫•y ch·ª©ng nh·∫≠n",
    example: "She received a certificate of completion.",
  },
  {
    id: 19,
    word: "issue",
    ipa: "/Àà…™ É.uÀê/",
    meaning: "v·∫•n ƒë·ªÅ / ban h√†nh",
    example: "We discussed the issue at the meeting.",
  },
  {
    id: 20,
    word: "in effect",
    ipa: "/…™n …™Ààfekt/",
    meaning: "c√≥ hi·ªáu l·ª±c",
    example: "The new law is now in effect.",
  },
  {
    id: 21,
    word: "renovation",
    ipa: "/Àåren.…ôÀàve…™. É…ôn/",
    meaning: "s·ª± c·∫£i t·∫°o, s·ª≠a ch·ªØa",
    example: "The hotel is closed for renovation.",
  },
  {
    id: 22,
    word: "latest",
    ipa: "/Ààle…™.t…™st/",
    meaning: "m·ªõi nh·∫•t",
    example: "Have you heard the latest news?",
  },
  {
    id: 23,
    word: "successful",
    ipa: "/s…ôkÀàses.f…ôl/",
    meaning: "th√†nh c√¥ng",
    example: "The project was very successful.",
  },
  {
    id: 24,
    word: "selection",
    ipa: "/s…™Ààlek. É…ôn/",
    meaning: "s·ª± l·ª±a ch·ªçn",
    example: "The store offers a wide selection of shoes.",
  },
  {
    id: 25,
    word: "overseas",
    ipa: "/Àå…ô ä.v…ôÀàsiÀêz/",
    meaning: "·ªü n∆∞·ªõc ngo√†i",
    example: "They plan to expand the business overseas.",
  },
  {
    id: 26,
    word: "candidate",
    ipa: "/Ààk√¶n.d…™.de…™t/",
    meaning: "·ª©ng vi√™n, th√≠ sinh",
    example: "He is a strong candidate for the job.",
  },
  {
    id: 27,
    word: "contract",
    ipa: "/Ààk…ín.tr√¶kt/ (n), /k…ônÀàtr√¶kt/ (v)",
    meaning: "h·ª£p ƒë·ªìng (n) / k√Ω h·ª£p ƒë·ªìng (v)",
    example: "Read the contract carefully before signing.",
  },
  {
    id: 28,
    word: "lease",
    ipa: "/liÀês/",
    meaning: "cho thu√™ / h·ª£p ƒë·ªìng thu√™",
    example: "We signed a lease for the apartment.",
  },
  {
    id: 29,
    word: "expire",
    ipa: "/…™kÀàspa…™…ôr/",
    meaning: "h·∫øt h·∫°n",
    example: "My passport will expire next month.",
  },
  {
    id: 30,
    word: "afford",
    ipa: "/…ôÀàf…îÀêd/",
    meaning: "ƒë·ªß kh·∫£ nƒÉng chi tr·∫£",
    example: "I can't afford a new car right now.",
  },
  {
    id: 31,
    word: "launch",
    ipa: "/l…îÀênt É/",
    meaning: "ra m·∫Øt, tung ra",
    example: "They will launch the new product tomorrow.",
  },
  {
    id: 32,
    word: "access",
    ipa: "/Àà√¶k.ses/",
    meaning: "s·ª± ti·∫øp c·∫≠n, truy c·∫≠p",
    example: "Do you have access to the internet?",
  },
  {
    id: 33,
    word: "competitor",
    ipa: "/k…ômÀàpet.…™.t…ôr/",
    meaning: "ƒë·ªëi th·ªß c·∫°nh tranh",
    example: "We need to stay ahead of our competitors.",
  },
  {
    id: 34,
    word: "commute",
    ipa: "/k…ôÀàmjuÀêt/",
    meaning: "di chuy·ªÉn ƒëi l√†m",
    example: "He has a long daily commute.",
  },
  {
    id: 35,
    word: "upcoming",
    ipa: "/Àà åpÀåk åm.…™≈ã/",
    meaning: "s·∫Øp t·ªõi",
    example: "I am preparing for the upcoming exam.",
  },
  {
    id: 36,
    word: "deadline",
    ipa: "/Ààded.la…™n/",
    meaning: "th·ªùi h·∫°n",
    example: "The deadline for the report is Friday.",
  },
  {
    id: 37,
    word: "reach",
    ipa: "/riÀêt É/",
    meaning: "ƒë·∫°t ƒë·∫øn, li√™n l·∫°c",
    example: "You can reach me by email.",
  },
  {
    id: 38,
    word: "appointment",
    ipa: "/…ôÀàp…î…™nt.m…ônt/",
    meaning: "cu·ªôc h·∫πn",
    example: "I have a doctor's appointment at 3 PM.",
  },
  {
    id: 39,
    word: "book",
    ipa: "/b äk/",
    meaning: "ƒë·∫∑t (v√©, b√†n)",
    example: "I need to book a flight to London.",
  },
  {
    id: 40,
    word: "unfortunately",
    ipa: "/ ånÀàf…îÀê.t É…ôn.…ôt.li/",
    meaning: "kh√¥ng may thay",
    example: "Unfortunately, the tickets are sold out.",
  },
  {
    id: 41,
    word: "last",
    ipa: "/l…ëÀêst/",
    meaning: "k√©o d√†i / cu·ªëi c√πng",
    example: "The meeting lasted for two hours.",
  },
  {
    id: 42,
    word: "recharge",
    ipa: "/ÀåriÀêÀàt É…ëÀêd í/",
    meaning: "n·∫°p l·∫°i, s·∫°c l·∫°i",
    example: "I need to recharge my phone.",
  },
  {
    id: 43,
    word: "limited",
    ipa: "/Ààl…™m.…™.t…™d/",
    meaning: "h·∫°n ch·∫ø",
    example: "This is a limited time offer.",
  },
  {
    id: 44,
    word: "payment",
    ipa: "/Ààpe…™.m…ônt/",
    meaning: "thanh to√°n",
    example: "We accept payment by credit card.",
  },
  {
    id: 45,
    word: "handle",
    ipa: "/Ààh√¶n.d…ôl/",
    meaning: "x·ª≠ l√Ω, gi·∫£i quy·∫øt",
    example: "She handles customer complaints.",
  },
  {
    id: 46,
    word: "process",
    ipa: "/Ààpr…ô ä.ses/",
    meaning: "quy tr√¨nh / x·ª≠ l√Ω",
    example: "We are in the process of moving.",
  },
  {
    id: 47,
    word: "include",
    ipa: "/…™nÀàkluÀêd/",
    meaning: "bao g·ªìm",
    example: "The price includes tax.",
  },
  {
    id: 48,
    word: "local",
    ipa: "/Ààl…ô ä.k…ôl/",
    meaning: "thu·ªôc ƒë·ªãa ph∆∞∆°ng",
    example: "Support your local businesses.",
  },
  {
    id: 49,
    word: "approve",
    ipa: "/…ôÀàpruÀêv/",
    meaning: "ch·∫•p thu·∫≠n",
    example: "The manager approved the budget.",
  },
  {
    id: 50,
    word: "cost estimate",
    ipa: "/k…íst Ààes.t…™.me…™t/",
    meaning: "∆∞·ªõc t√≠nh chi ph√≠",
    example: "Get a cost estimate before starting the work.",
  },
  {
    id: 51,
    word: "improve",
    ipa: "/…™mÀàpruÀêv/",
    meaning: "c·∫£i thi·ªán",
    example: "I want to improve my English skills.",
  },
  {
    id: 52,
    word: "expand",
    ipa: "/…™kÀàsp√¶nd/",
    meaning: "m·ªü r·ªông",
    example: "The company plans to expand its network.",
  },
  {
    id: 53,
    word: "election",
    ipa: "/iÀàlek. É…ôn/",
    meaning: "b·∫ßu c·ª≠",
    example: "Who won the presidential election?",
  },
  {
    id: 54,
    word: "charity",
    ipa: "/Ààt É√¶r.…ô.ti/",
    meaning: "t·ª´ thi·ªán",
    example: "All proceeds go to charity.",
  },
  {
    id: 55,
    word: "branch",
    ipa: "/br…ëÀênt É/",
    meaning: "chi nh√°nh",
    example: "Our bank has a branch in every city.",
  },
  {
    id: 56,
    word: "commercial",
    ipa: "/k…ôÀàm…úÀê. É…ôl/",
    meaning: "thu·ªôc th∆∞∆°ng m·∫°i / qu·∫£ng c√°o",
    example: "I saw a funny commercial on TV.",
  },
  {
    id: 57,
    word: "license",
    ipa: "/Ààla…™.s…ôns/",
    meaning: "gi·∫•y ph√©p",
    example: "You need a license to drive a car.",
  },
  {
    id: 58,
    word: "application",
    ipa: "/Àå√¶p.l…™Ààke…™. É…ôn/",
    meaning: "ƒë∆°n ·ª©ng tuy·ªÉn/ƒëƒÉng k√Ω",
    example: "Fill out the job application form.",
  },
  {
    id: 59,
    word: "venue",
    ipa: "/Ààven.juÀê/",
    meaning: "ƒë·ªãa ƒëi·ªÉm (t·ªï ch·ª©c s·ª± ki·ªán)",
    example: "The hotel is a perfect venue for the wedding.",
  },
  {
    id: 60,
    word: "registration",
    ipa: "/Àåred í.…™Ààstre…™. É…ôn/",
    meaning: "s·ª± ƒëƒÉng k√Ω",
    example: "Registration starts at 8 AM.",
  },
  {
    id: 61,
    word: "investor",
    ipa: "/…™nÀàves.t…ôr/",
    meaning: "nh√† ƒë·∫ßu t∆∞",
    example: "The startup is looking for investors.",
  },
  {
    id: 62,
    word: "assistance",
    ipa: "/…ôÀàs…™s.t…ôns/",
    meaning: "s·ª± h·ªó tr·ª£",
    example: "Do you need any assistance?",
  },
  {
    id: 63,
    word: "enroll",
    ipa: "/…™nÀàr…ô äl/",
    meaning: "ghi danh, nh·∫≠p h·ªçc",
    example: "She decided to enroll in a cooking class.",
  },
  {
    id: 64,
    word: "accountant",
    ipa: "/…ôÀàka än.t…ônt/",
    meaning: "k·∫ø to√°n",
    example: "An accountant manages financial records.",
  },
  {
    id: 65,
    word: "store",
    ipa: "/st…îÀêr/",
    meaning: "c·ª≠a h√†ng",
    example: "I'm going to the grocery store.",
  },
  {
    id: 66,
    word: "warehouse",
    ipa: "/Ààwe…ô.ha äs/",
    meaning: "kho h√†ng",
    example: "The goods are stored in a large warehouse.",
  },
  {
    id: 67,
    word: "inconvenience",
    ipa: "/Àå…™n.k…ônÀàviÀê.ni.…ôns/",
    meaning: "s·ª± b·∫•t ti·ªán",
    example: "We apologize for the inconvenience.",
  },
  {
    id: 68,
    word: "inventory",
    ipa: "/Àà…™n.v…ôn.t…ôr.i/",
    meaning: "h√†ng t·ªìn kho, s·ª± ki·ªÉm k√™",
    example: "They are taking inventory of the stock.",
  },
  {
    id: 69,
    word: "initiative",
    ipa: "/…™Ààn…™ É.…ô.t…™v/",
    meaning: "s√°ng ki·∫øn, s·ª± ch·ªß ƒë·ªông",
    example: "He showed great initiative in solving the problem.",
  },
  {
    id: 70,
    word: "mayor",
    ipa: "/me…ôr/",
    meaning: "th·ªã tr∆∞·ªüng",
    example: "The mayor gave a speech today.",
  },
  {
    id: 71,
    word: "address",
    ipa: "/Àà√¶d.res/ (n), /…ôÀàdres/ (v)",
    meaning: "ƒë·ªãa ch·ªâ (n) / di·ªÖn thuy·∫øt, gi·∫£i quy·∫øt (v)",
    example: "Please write your address clearly.",
  },
  {
    id: 72,
    word: "conduct",
    ipa: "/k…ônÀàd åkt/",
    meaning: "ti·∫øn h√†nh, th·ª±c hi·ªán",
    example: "They will conduct a survey next week.",
  },
  {
    id: 73,
    word: "resident",
    ipa: "/Ààrez.…™.d…ônt/",
    meaning: "c∆∞ d√¢n",
    example: "He is a resident of this apartment complex.",
  },
  {
    id: 74,
    word: "diverse",
    ipa: "/da…™Ààv…úÀês/",
    meaning: "ƒëa d·∫°ng",
    example: "The city has a diverse population.",
  },
  {
    id: 75,
    word: "skilled",
    ipa: "/sk…™ld/",
    meaning: "c√≥ k·ªπ nƒÉng, l√†nh ngh·ªÅ",
    example: "We need skilled workers for this project.",
  },
  {
    id: 76,
    word: "recruit",
    ipa: "/r…™ÀàkruÀêt/",
    meaning: "tuy·ªÉn d·ª•ng",
    example: "The army is trying to recruit more soldiers.",
  },
  {
    id: 77,
    word: "correct",
    ipa: "/k…ôÀàrekt/",
    meaning: "ch√≠nh x√°c / s·ª≠a ch·ªØa",
    example: "Is this the correct answer?",
  },
  {
    id: 78,
    word: "suitable",
    ipa: "/ÀàsuÀê.t…ô.b…ôl/",
    meaning: "ph√π h·ª£p",
    example: "This movie is not suitable for children.",
  },
  {
    id: 79,
    word: "complimentary",
    ipa: "/Àåk…ím.pl…™Ààmen.t…ôr.i/",
    meaning: "mi·ªÖn ph√≠",
    example: "We offer complimentary coffee in the lobby.",
  },
  {
    id: 80,
    word: "unavailable",
    ipa: "/Àå ån.…ôÀàve…™.l…ô.b…ôl/",
    meaning: "kh√¥ng c√≥ s·∫µn",
    example: "The doctor is currently unavailable.",
  },
];
// ... (Ph·∫ßn danh s√°ch vocabularyData ·ªü tr√™n gi·ªØ nguy√™n) ...

// --- BI·∫æN TO√ÄN C·ª§C ---
let currentList = [...vocabularyData]; // T·∫°o b·∫£n sao ƒë·ªÉ thao t√°c (h·ªó tr·ª£ shuffle)
let currentIndex = 0;
let learnedWords = JSON.parse(localStorage.getItem("learnedWords")) || [];

// --- DOM ELEMENTS ---
const navItems = document.querySelectorAll("nav ul li");
const sections = document.querySelectorAll(".section");

// Flashcard Elements
const card = document.getElementById("flashcard");
const wordEl = document.getElementById("vocab-word");
const ipaEl = document.getElementById("vocab-ipa");
const meaningEl = document.getElementById("vocab-meaning");
const exampleEl = document.getElementById("vocab-example");
const countEl = document.getElementById("card-counter");
const btnNext = document.getElementById("btn-next");
const btnPrev = document.getElementById("btn-prev");
const btnSpeak = document.getElementById("btn-speak");
const btnMarkLearned = document.getElementById("btn-mark-learned");

// New Controls Elements
const jumpInput = document.getElementById("jump-input");
const btnJump = document.getElementById("btn-jump");
const btnShuffle = document.getElementById("btn-shuffle");

// Quiz Elements
const quizWord = document.getElementById("quiz-word");
const quizOptions = document.getElementById("quiz-options");
const quizFeedback = document.getElementById("quiz-feedback");
const btnNextQuiz = document.getElementById("btn-next-quiz");

// Progress Elements
const learnedCountEl = document.getElementById("learned-count");
const totalCountEl = document.getElementById("total-count");
const progressPercentEl = document.getElementById("progress-percent");
const btnReset = document.getElementById("btn-reset");

// --- H√ÄM KH·ªûI T·∫†O ---
function init() {
  setupNavigation();
  renderCard(currentIndex);
  updateProgressUI();
  loadQuiz();

  // ƒê·∫∑t gi·ªõi h·∫°n max cho √¥ input jump
  jumpInput.max = currentList.length;
}

// --- 1. LOGIC FLASHCARD (ƒê√£ c·∫≠p nh·∫≠t ƒë·ªÉ d√πng currentList) ---

function renderCard(index) {
  const data = currentList[index]; // L·∫•y d·ªØ li·ªáu t·ª´ danh s√°ch hi·ªán t·∫°i (ƒë√£/ch∆∞a shuffle)

  card.classList.remove("flipped");

  setTimeout(() => {
    wordEl.textContent = data.word;
    ipaEl.textContent = data.ipa;
    meaningEl.textContent = data.meaning;
    exampleEl.textContent = `"${data.example}"`;
    // Hi·ªÉn th·ªã s·ªë trang: Index + 1 / T·ªïng s·ªë
    countEl.textContent = `${index + 1} / ${currentList.length}`;

    // C·∫≠p nh·∫≠t gi√° tr·ªã √¥ input ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt ƒëang ·ªü ƒë√¢u
    jumpInput.value = index + 1;

    // Ki·ªÉm tra tr·∫°ng th√°i ƒë√£ h·ªçc (d·ª±a tr√™n ID g·ªëc c·ªßa t·ª´)
    if (learnedWords.includes(data.id)) {
      btnMarkLearned.textContent = "‚úÖ ƒê√£ thu·ªôc (ƒê√£ l∆∞u)";
      btnMarkLearned.disabled = true;
      btnMarkLearned.style.opacity = "0.6";
    } else {
      btnMarkLearned.textContent = "‚úÖ ƒê√°nh d·∫•u ƒë√£ thu·ªôc";
      btnMarkLearned.disabled = false;
      btnMarkLearned.style.opacity = "1";
    }
  }, 200);
}

// L·∫≠t th·∫ª
card.addEventListener("click", () => card.classList.toggle("flipped"));

// Next / Prev
btnNext.addEventListener("click", (e) => {
  e.stopPropagation();
  if (currentIndex < currentList.length - 1) {
    currentIndex++;
    renderCard(currentIndex);
  }
});

btnPrev.addEventListener("click", (e) => {
  e.stopPropagation();
  if (currentIndex > 0) {
    currentIndex--;
    renderCard(currentIndex);
  }
});

// Text to Speech
btnSpeak.addEventListener("click", (e) => {
  e.stopPropagation();
  const utterance = new SpeechSynthesisUtterance(
    currentList[currentIndex].word
  );
  utterance.lang = "en-US";
  utterance.rate = 0.8;
  window.speechSynthesis.speak(utterance);
});

// ƒê√°nh d·∫•u ƒë√£ h·ªçc
btnMarkLearned.addEventListener("click", (e) => {
  e.stopPropagation();
  const currentId = currentList[currentIndex].id;
  if (!learnedWords.includes(currentId)) {
    learnedWords.push(currentId);
    saveProgress();
    renderCard(currentIndex);
    updateProgressUI();
  }
});

// --- T√çNH NƒÇNG M·ªöI: JUMP & SHUFFLE ---

// 1. Ch·ª©c nƒÉng Nh·∫£y ƒë·∫øn trang (Jump)
btnJump.addEventListener("click", () => {
  const pageNumber = parseInt(jumpInput.value);

  if (pageNumber >= 1 && pageNumber <= currentList.length) {
    currentIndex = pageNumber - 1; // V√¨ m·∫£ng b·∫Øt ƒë·∫ßu t·ª´ 0
    renderCard(currentIndex);
  } else {
    alert(`Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn ${currentList.length}`);
  }
});

// Cho ph√©p ·∫•n Enter trong √¥ input
jumpInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") btnJump.click();
});

// 2. Ch·ª©c nƒÉng X√°o tr·ªôn (Shuffle)
btnShuffle.addEventListener("click", () => {
  // Thu·∫≠t to√°n Fisher-Yates Shuffle
  for (let i = currentList.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [currentList[i], currentList[j]] = [currentList[j], currentList[i]];
  }

  // Reset v·ªÅ th·∫ª ƒë·∫ßu ti√™n sau khi tr·ªôn
  currentIndex = 0;
  renderCard(currentIndex);

  // Hi·ªáu ·ª©ng th√¥ng b√°o nh·ªè
  const originalText = btnShuffle.innerText;
  btnShuffle.innerText = "ƒê√£ tr·ªôn xong!";
  setTimeout(() => {
    btnShuffle.innerText = originalText;
  }, 1500);
});

// --- C√ÅC PH·∫¶N C√íN L·∫†I (GI·ªÆ NGUY√äN) ---

function setupNavigation() {
  navItems.forEach((item) => {
    item.addEventListener("click", () => {
      navItems.forEach((nav) => nav.classList.remove("active"));
      item.classList.add("active");
      const targetId = item.getAttribute("data-target");
      sections.forEach((sec) => sec.classList.remove("active-section"));
      document.getElementById(targetId).classList.add("active-section");
    });
  });
}
window.navigateTo = (targetId) =>
  document.querySelector(`nav ul li[data-target="${targetId}"]`).click();

// Quiz Logic
function loadQuiz() {
  quizFeedback.textContent = "";
  quizOptions.innerHTML = "";
  btnNextQuiz.style.display = "none";

  // V·∫´n d√πng vocabularyData g·ªëc cho quiz ƒë·ªÉ ƒë·∫£m b·∫£o ng·∫´u nhi√™n ƒë·ªôc l·∫≠p v·ªõi flashcard
  const correctData =
    vocabularyData[Math.floor(Math.random() * vocabularyData.length)];
  quizWord.textContent = correctData.word;

  let options = [correctData];
  while (options.length < 4) {
    const randomItem =
      vocabularyData[Math.floor(Math.random() * vocabularyData.length)];
    if (!options.includes(randomItem)) options.push(randomItem);
  }
  options.sort(() => Math.random() - 0.5);

  options.forEach((opt) => {
    const btn = document.createElement("button");
    btn.classList.add("option-btn");
    btn.textContent = opt.meaning;
    btn.onclick = () => checkAnswer(opt.id, correctData.id, btn);
    quizOptions.appendChild(btn);
  });
}

function checkAnswer(selectedId, correctId, btnElement) {
  const allBtns = document.querySelectorAll(".option-btn");
  allBtns.forEach((b) => (b.disabled = true));
  if (selectedId === correctId) {
    btnElement.classList.add("correct");
    quizFeedback.textContent = "Ch√≠nh x√°c! üéâ";
    quizFeedback.style.color = "var(--success)";
  } else {
    btnElement.classList.add("wrong");
    quizFeedback.textContent = "Sai r·ªìi! üòÖ";
    quizFeedback.style.color = "var(--error)";
    allBtns.forEach((b) => {
      if (
        b.textContent === vocabularyData.find((v) => v.id === correctId).meaning
      )
        b.classList.add("correct");
    });
  }
  btnNextQuiz.style.display = "inline-block";
}
btnNextQuiz.addEventListener("click", loadQuiz);

// Progress Logic
function saveProgress() {
  localStorage.setItem("learnedWords", JSON.stringify(learnedWords));
}
function updateProgressUI() {
  const total = vocabularyData.length;
  const learned = learnedWords.length;
  const percent = Math.round((learned / total) * 100);
  learnedCountEl.textContent = learned;
  totalCountEl.textContent = total;
  progressPercentEl.textContent = `${percent}%`;
  progressPercentEl.style.color =
    percent === 100 ? "var(--success)" : "var(--primary)";
}
btnReset.addEventListener("click", () => {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô ti·∫øn ƒë·ªô h·ªçc kh√¥ng?")) {
    learnedWords = [];
    saveProgress();
    updateProgressUI();
    renderCard(currentIndex);
  }
});

// Ch·∫°y ·ª©ng d·ª•ng
document.addEventListener("DOMContentLoaded", init);
